{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags compress home_tags %}

{% block content %}
{% with project=self %}

<div class="layout-page-content--full">
  <div class="page-content">
    <div class="page-content__box">
      
      <div class="layout-project-content">
        <div class="layout-project-header">
          <a href="/projects"><h5 class="page-section-header">Projects</h5></a>
          <h1>{{ project.title }}</h1>
        </div>
        <div class="layout-project-main-info">
          <div class="project-main-image">{% image project.image width-500 %}</div>
          <div>{{ project.full_description|richtext }}</div>
        </div>
        <aside class="layout-project-additional-info">
          <div class="project-additional-info__content">
            <div class="project-status project-status--{{project.status}}">Project status: {{ project.get_status_display }}</div>
            {% if project.roles.all %}

                <div class="project-people">
                  <h4>People</h4>
                  <ul>
                  {% for role in project.roles.all %}
                    <li><a href={{role.person.contact}}><span class="people-role">{{ role.type }}</span>: {{ role.person.name }}</a></li>
                  {% endfor %}
                  </ul>
                </div>
            {% endif %}
            <div class="project-kpis">
            <h4>Key performance indicators</h4>
            <ul>
            {% with project.piwik_data as piwik_data %}
                {% if piwik_data %}
                    <li><span class="kpis-name">Visits yesterday</span>: <span class="kpis-value kpis-value--yesterday">{{ piwik_data.nb_visits }}</span></li>
                {% endif %}
            {% endwith %}
            {% with project.uptime_data as uptime_data %}
                {% if uptime_data %}
                    <li><span class="kpis-name">Total uptime average</span>: <span class="kpis-value kpis-value--uptime">{{ project.uptime_data.alltimeuptimeratio }} %</span></li>
                {% endif %}
            {% endwith %}
            {% if project.kpis.all %}
                {% for kpi in project.kpis.all %}
                    <li><span class="kpis-name">{{ kpi.name }}</span>: <span class="kpis-value">{{ kpi.value }}</span><br/>
                    <span class="kpis-description">{{ kpi.description }}</span></li>
                {% endfor %}
            {% endif %}
            </ul>
            </div>
            {% query project.links public=True as links %}
                {% if links %}
                    <div class="project-links">
                    <h4>Links</h4>
                    <ul>
                    {% for link in links %}
                      <li><a href={{ link.url }}><span class="links-name">{{ link.type }}</span><br/>
                        <span class="links-description">{{ link.description }}</span></a></li>
                    {% endfor %}
                    </ul>
                    </div>
                {% endif %}
          </div>
        </aside>
      </div>
      
    </div>
  </div>
</div>

{% endwith %}
{% endblock %}